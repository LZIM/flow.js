<html>

<head>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/lodash/lodash.js"></script>
    <script src="/node_modules/epicenter-js/dist/epicenter.min.js"></script>
    <script src="/dist/flow-edge.js"></script>
</head>

<body data-f-model="">

    <section>
        <h3>Specific Run</h3>
        <div>
            Run <span class="output"  bind="000001592427458bc60275dfdbad64f4d25a:meta:id"></span>
        </div>
        <label for="">Name</label>
        <input type="text" id="specificRunName" bind="000001592427458bc60275dfdbad64f4d25a:meta:name">
        <div class="output" bind="000001592427458bc60275dfdbad64f4d25a:meta:name"></div>
    </section>
    <section>
        <h3>Default Run</h3>
        <h6>Explicit variable scope</h6>
        <label for="txtPrice">Price</label>
        <input type="text" id="txtPrice" bind="variable:Price"/>
        <div class="output" bind="variable:Price"></div>
        <br>

        <h6>shorthand variable scope</h6>
        <label for="txtPrice2">Price</label>
        <input type="text" id="txtPrice2" bind="Price"/>
        <div class="output" bind="Price"></div>

        
        <label for="txtName">Name</label>
        <input type="text" id="txtName" bind="meta:name"/>
        <div class="output" bind="meta:name"></div>

        <button id="btnStep">Step</button>
    </section>
    <script>
    var sm = new Flow.SubsManager({
        run: {
            serviceOptions: {
                strategy: 'new-if-missing',
                run: {
                    account: 'jaimedp',
                    project: 'glasses',
                    model: 'gglasses.vmf',
                }
            },
            // initialOperation: 'start_game',
            variables: {
                readOnly: false,
                silent: false,
            },
            operations: {
                silent: true,
            }
        }
    });


    $('#specificRunName, #txtPrice, #txtPrice2, #txtName').on('change', function (evt) {
        var val = ($(evt.target).val());
        val = isNaN(Number(val)) ? val : Number(val);
        sm.publish($(evt.target).attr('bind'), val);
    });

    sm.subscribe([
        'variable:Price',
        'Price',
        'meta:name',

        '000001592427458bc60275dfdbad64f4d25a:meta:name',
        '000001592427458bc60275dfdbad64f4d25a:meta:id',
    ], function (val) {
        Object.keys(val).forEach(function (key) {
            $('.output[bind="' + key + '"]').html(val[key]);
        });
    });


    $('#btnStep').on('click', function (evt) {
        sm.publish('operation:step');
    });
    window.sm = sm;
    </script>
</body>

</html>
